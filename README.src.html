<!doctype html>
<html lang="en-gb-x-sneddy">
<meta charset="utf-8">
<title>spec-gen 1.0b1-dev</title>
<link rel="stylesheet" href="http://www.whatwg.org/style/specification"> <style>
a:not([href]) {
background-color: #00f;
color: #fff;
}
span:not([title=""]):not(.secno) {
background-color: #a00;
color: #fff;
}
</style>

<div class="head">
	<h1>[TITLE]</h1>
	<h2 class="no-num no-toc">Documentation — [DATE]</h2>
</div>

<h2 class="no-num no-toc">Contents</h2>
<!--toc-->

<h2>Introduction</h2>

<p>The need for the spec-gen came from the need for long technical documents to
include niceties such as cross-references and a table of contents for the
purpose of easy navigation — doing this manually can be a great chore
especially when sections are numbered and a section is added, consequently
changing the numbering of many others, leading to it being advantageous to do it
programmatically.</p>

<h2>Installing the spec-gen</h2>

<h3>Requirements</h3>

<p>The following are the minimum requirements: later versions should also work
without issue.</p>

<ul>
	<li><a>Python</a> 2.5
	<li><a>lxml</a> 2.0
	<li><a>html5lib</a> 0.10
</ul>

<h3>Obtaining a copy</h3>

<p>Releases are occasionally made. A link to the latest release can be found
from the <a>spec-gen website</a>.</p>

<p>Alternatively, a copy can be obtained from <dfn>our <a>Mercurial</a>
repository</dfn>: this is where our ongoing development occurs, and allows any
revision (and therefore any release) to be downloaded. Our repository is located
at
<code><!--begin-link-->http://hg.gsnedders.com/spec-gen/<!--end-link--></code>.

<h3>Installation</h3>

<p>Normally, installation is done through <a>setuptools</a>, with the following
command:</p>

<p><code>python setup.py install</code></p>

<p>Please see setuptools' documentation for information on installation options
(such as installing in non-standard locations).</p>

<h3>Running the test suite</h3>

<p>The source distribution and the current development copy (in <span title="our
mercurial repository">Mercurial</span>) both contain a test suite. It can be run
with the following command:</p>

<p><code>python runtests.py</code></p>

<p>Any test failures should be reported at our <dfn><a
href="http://bugs.gsnedders.com/projects/show/spec-gen">bug
tracker</a></dfn>.</p>

<h2>Using the spec-gen</h2>

<p>The spec-gen is invoked through the <code>spec-gen</code> command. The
<dfn><code>--help</code></dfn> (or <dfn><code>-h</code></dfn>) option gives some
basic help.</p>

<p>The most basic options alter what is used to parse and serialize the
document: by default, html5lib is used to parse the document; passing the
<dfn><code>--lxml.html</code></dfn> option uses libxml2's HTML parser and
serializer instead (this is quicker, but does not comply to the <a>HTML 5</a>
standard, and sometimes results in a <span>fatal error</span>)<!--; passing the
XXX: need double hyphen <dfn><code>xml</code></dfn> option uses libxml2's XML
parser instead-->.</p>

<p>The spec-gen offers a <dfn>compatibility mode</dfn>, which aims to be
compatible with the <a>CSS3 module postprocessor</a> (within reason). This is
mainly provided for the sake of pre-existing <a>W3C</a> documents. The
<dfn><code>--w3c-compat</code></dfn> option turns on this compatibility mode,
although specific options that turn on just one compatibility feature at a time
are also available (and are documented below under each <span
title="processes">process</span>) — these are all implied by the
<code>--w3c-compat</code> options, with one exception:
<code>--w3c-compat-crazy-substitutions</code>, as it can lead to undesirable
results.</p>

<p>Other <span title="processes">process</span> specific options are documented
under the <span title="processes">process</span> to which they belong.</p>

<h2><dfn>Processes</dfn></h2>

<p>The elements listed in the below processes, except where otherwise stated,
are the local name of the element <!--either--> in null namespace<!-- or in the
<dfn>HTML namespace</dfn> (<code>http://www.w3.org/1999/xhtml</code>)-->.</p>

<p>Upon a <dfn>fatal error</dfn> processing of the document is terminated and
nothing is written to the output file.</p>

<p>The <dfn>textContent</dfn> property is the same as that defined in <a>DOM
Level 3 Core</a> on the Node interface.</p>

<p><dfn>Whitespace</dfn> is as defined in <a>HTML 5</a>: <q>U+0020 SPACE, U+0009
CHARACTER TABULATION (tab), U+000A LINE FEED (LF), U+000C FORM FEED (FF), and
U+000D CARRIAGE RETURN (CR)</q>.</p>

<h3>Cross-referencing</h3>

<p><dfn>Cross-referencing</dfn> has two essential parts: <dfn
title="term">terms</dfn> that define what something is, and <dfn
title="instance">instances</dfn> of those terms.</p>

<p><span title="term">Terms</span> are marked-up using the <code>dfn</code>
element: the <span>term</span> itself is taken from the <code>title</code>
attribute if it is present, otherwise it is taken from the
<span>textContent</span> property of the <code>dfn</code> element. By default,
the spec-gen will throw a <span>fatal error</span> if a <span>term</span> is
defined more than once: this behaviour can be turned off (causing the final
definition of the <span>term</span> to be the one that is used) by the
<dfn><code>--allow-duplicate-terms</code></dfn> option.

<p><span title="instance">Instances</span> are marked-up with various elements,
depending on the setting of <dfn><code>--w3c-compat-elements</code></dfn>: if it
is disabled (the default), the <code>abbr</code>, <code>code</code>,
<code>i</code>, <code>span</code>, and <code>var</code> elements are used for
<span title="instance">instances</span>; if it is enabled, the
<code>abbr</code>, <code>acronym</code>, <code>b</code>, <code>bdo</code>,
<code>big</code>, <code>code</code>, <code>del</code>, <code>em</code>,
<code>i</code>, <code>ins</code>, <code>kbd</code>, <code>label</code>,
<code>legend</code>, <code>q</code>, <code>samp</code>, <code>small</code>,
<code>span</code>, <code>strong</code>, <code>sub</code>, <code>sup</code>,
<code>tt</code>, <code>var</code> elements are used for <span
title="instance">instances</span>. Those that are only there in
<span>compatibility mode</span> are there because either they should not
semantically be used for an <span>instance</span>, or because they are not
present in <a>HTML 5</a>. Similar to <span
title="term">terms</span>, the <span>instance</span> is taken from the
<code>title</code> attribute if it is present, otherwise it is taken from the
<span>textContent</span> property. An <span>instance</span> is only used if it
does not have an <code>a</code>, <code>dfn</code>, or <code>datagrid</code>
element as either a parent or a child.</p>

<p>Both <span title="term">terms</span> and <span
title="instance">instances</span> are <dfn title="cross-reference
normalization">normalized</dfn> as follows:</p>

<ul>
	<li>Leading and trailing <span>whitespace</span> is stripped,
	<li>Converted to lowercase (behaviour of this is dependent on the current
locale setting of Python),
	<li>All consecutive <span>whitespace</span> is replaced with a single U+0020
SPACE CHARACTER<!-- unless there is a <code>pre</code> element as a parent-->,
and
	<li>If <dfn><code>--w3c-compat-xref-normalization</code></dfn> is enabled, all
characters apart from U+0020 SPACE CHARACTER, U+002D HYPHEN-MINUS (-), U+0030
DIGIT ZERO to U+0039 DIGIT NINE (0–9), U+0041 LATIN CAPITAL LETTER A to U+005A
LATIN CAPITAL LETTER Z (A–Z), and U+0061 LATIN SMALL LETTER A to U+007A LATIN
SMALL LETTER Z (a–z) are removed.
</ul>

<p>If the <span>instance</span> is contained within a <code>span</code> element,
the <code>span</code> element is turned into an <code>a</code> element, and a
<code>href</code> attribute is added to link it to the <span>term</span> (e.g.,
<code>&lt;span>foo&lt;/span></code> becomes <code>&lt;a
href=#foo>foo&lt;/a></code>) — all other attributes are preserved. Otherwise
(when the <span>instance</span> is not contained within a <code>span</code>
element), the location of the <code>a</code> element when linking an
<span>instance</span> is dependent on the
<dfn><code>--w3c-compat-xref-a-placement</code></dfn> option: if it is disabled
(the default), the <code>a</code> element is placed around the element
containing the <span>instance</span> (e.g., <code>&lt;i>foo&lt;/i></code>
becomes <code>&lt;a href=#foo>&lt;i>foo&lt;/i>&lt;/a></code>); if it is enabled,
the <code>a</code> element goes within the element containing the
<span>instance</span> and goes around all of its content (e.g.,
<code>&lt;i>foo&lt;/i></code> becomes <code>&lt;i>&lt;a
href=#foo>foo&lt;/a>&lt;/i></code>).</p>

<h3>Table of contents/section numbering</h3>

<p>To create a table of contents, and to number the <span
title="section">sections</span> of the document, an <dfn>outline</dfn> is
created (this is a list of <span title="section">sections</span>, which can each
contain more <span title="section">sections</span>, where a <dfn>section</dfn>
represents a part of the document, and often has a <dfn title="section
heading">heading</dfn> associated with it — for more detailed definitions see
<a>HTML 5</a>). This means not only are the <code>h1</code>–<code>h6</code>
elements supported, but also elements such as <code title="">section</code> are
used to create the <span>outline</span>. After creating the
<span>outline</span>, every <span>section</span> with a depth between those
provided by <dfn><code>--min-depth</code></dfn> and
<dfn><code>--max-depth</code></dfn> (defaulting to two and six respectively),
and which has a <span title="section heading">heading</span>, is numbered if it
does not have <code>no-num</code> as a class, and is added to the table of
contents if it does not have <code>no-toc</code> as a class. <span
title="section">Sections</span> without a <span title="section
heading">heading</span> are treated as if they did not exist, unless they have
children, in which they will appear to exist while not existing all at once
(e.g., they increment the <span>section</span> numbering, though that is not
output anywhere; and they get a list item in the table of contents, with only
the children within it, and no link to the <span>section</span> itself).</p>

<p>The format of <span>section</span> numbers should comply with <a>ISO
2145:1978</a>, Numbering of divisions and subdivisions in written documents.
This means that each <span>section</span> number is given by Arabic numerals,
seperated by a single U+002E FULL STOP character, and there is no trailing
U+002E FULL STOP character.</p>

<p>The <span>section</span> number is inserted as the first child node of the
<span>section heading</span> as a <code>span</code> element with the
<code>class</code> attribute set to <code>secno</code>: this is copied into the
table of contents.</p>

<p>Pre-existing <code>span</code> elements with a class of <code>secno</code>
are removed from all <span title="section heading">section headings</span>,
regardless of whether their depth falls within the range given by
<code>--min-depth</code> and <code>--max-depth</code>.</p>

<p>The table of contents is built up as an ordered list (an <code>ol</code>
element), with each <span>section</span> marked up as a <code>li</code> element,
and child <span title="section">sections</span> are marked up with an
<code>ol</code> within that <code>li</code> (and this continues recursively, ad
infinitum). By default, the root element of the table of contents (an
<code>ol</code> element) is given a <code>class</code> attribute set to
<code>toc</code>; however, with the
<dfn><code>--w3c-compat-class-toc</code></dfn> option this is placed on every
<code>ol</code> within the table of contents. The entire <span>section
heading</span> is copied to be the content of the list item, with all
<code>a</code>, and <code>dfn</code> elements and <code>id</code> attributes
removed.</p>

<p>The table of contents is inserted between a comment with a value equal to
(with leading and trailing <span>whitespace</span> removed)
<code>begin-toc</code> and one (under the same conditions) equal to
<code>end-toc</code>. If the comment with a value of <code>end-toc</code> does
that have the same parent as the previous <code>begin-toc</code> one, it is a
<span>fatal error</span>. Any nodes between the two are removed before the new
table of contents is inserted. Additionally, any comment (with leading and
trailing <span>whitespace</span> removed) with a value equal to <code>toc</code>
is replaced by the table of contents surrounded by <code>begin-toc</code> and
<code>end-toc</code> comments.</p>

<h3>String/comment substitution</h3>

<p>Various strings are replaced in magic ways: a <dfn>normal string
substitution</dfn> takes the form of <code>[xxx]</code> where xxx is
case-sensitively the replacement, which may be followed by any characters apart
from U+005D RIGHT SQUARE BRACKET (]) before the final U+005D RIGHT SQUARE
BRACKET character — these extra characters are effectively a comment, and
carry absolutely no meaning, and vanish into some as-of-yet unknown abyss when
the string replacement is done. The entire string must be contained within a
single text node.</p>

<p>The <dfn>W3C status</dfn> is found, when needed by one of the substitutions,
by iterating all text nodes in document order (i.e., attribute values and
comments have no effect), and for each node, the following is done:</p>

<ol>
	<li>If the node contains, case-insensitively, "latest version", searching
stops, and the default is used (ED).
	<li>Otherwise, if the node, case-sensitively, contains "http://www.w3.org/TR/"
followed by one of "MO", "WD", "CR", "PR", "REC", "PER", or "NOTE", which in
turn is followed by U+002D HYPHEN-MINUS (-), then the status is whatever matched
the previous list of options.
</ol>

<!-- I wish the above was more sane — it took me several hours to work out
(though the comment in the CSS3 Module Postprocessor docs saying, "If there is
a H2 subheading under the H1 that gives the spec's status, the [STATUS]
variable will be initialized from that, otherwise it will default to WD." did
not help me work it out quickly, as what is done is completely utterly
different to that) — even though the algorithm is simple enough, it is just
far too unexpected. Sadly, though, pre-existing documents depend on this very
exact behaviour, and thus it cannot be changed. -->

<p>There is also a <dfn>long W3C status</dfn>, which correlates to the <span>W3C
status</span> under the following mapping:</p>

<table>
	<tr>
		<th><span>W3C Status</span>
		<th><span>Long W3C Status</span>
	<tr>
		<td>MO
		<td>W3C Member-only Draft
	<tr>
		<td>ED
		<td>Editor's Draft
	<tr>
		<td>WD
		<td>W3C Working Draft
	<tr>
		<td>CR
		<td>W3C Candidate Recommendation
	<tr>
		<td>PR
		<td>W3C Proposed Recommendation
	<tr>
		<td>REC
		<td>W3C Recommendation
	<tr>
		<td>PER
		<td>W3C Proposed Edited Recommendation
	<tr>
		<td>NOTE
		<td>W3C Working Group Note
</table>

<p>By default, the <span title="normal string substitution">normal string
substitutions</span> are:</p>

<dl>
	<dt><code>[<!---->DATE]</code>
	<dd>This is replaced with the current date in the form of, e.g., <samp>31
July 2008</samp>. The word used for the month is dependent on the current locale
of Python.
	<dt><code>[<!---->CDATE]</code>
	<dd>This is replaced with the date in the form YYYYMMDD, e.g.,
<samp>20080731</samp>. This is a conforming <a>ISO 8601:2004</a> date.
	<dt><code>[<!---->YEAR]</code>
	<dd>This is replaced with the current year, in the form YYYY, e.g., 
<samp>2008</samp>. This is a conforming <a>ISO 8601:2004</a> year.
	<dt><code>[<!---->TITLE]</code>
	<dd>This is replaced with the <span>textContent</span> of the first
<code>title</code> element which is within the first <code>head</code> of the
document, or an empty string if such a <code>title</code> element does not
exist.
</dl>

<p>If <dfn><code>--w3c-compat-substitutions</code></dfn> is enabled, the
following <span title="normal string substitution">normal string
substitutions</span> are done in addition to those above:</p>

<dl>
	<dt><code>[STATUS]</code>
	<dd>This is replaced with the <span>W3C status</span>.
	<dt><code>[LONGSTATUS]</code>
	<dd>This is replaced with the <span>long W3C status</span>.
</dl>


